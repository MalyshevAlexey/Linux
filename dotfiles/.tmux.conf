base_index=2
conf_dir="~/.tmux/"
run-shell "tmux setenv -g TMUX_VERSION $(tmux -V | cut -c 6-)"
bind_prefix="-t prefix r"
# Основной префикс
set-option -g prefix C-a
# Дополнительный префикс
set-option -g prefix2 C-b
# Начало нумерации окон
set-option -g base-index $base_index
# Начало нумерации панелей
set-option -gw pane-base-index $base_index
# Количество буферов
set-option -g buffer-limit 50
# Массив пользовательских псевдонимов для команд
set-option -g command-alias[100] zoom="resize-pane -Z"
# Терминал по умолчанию
set-option -g default-terminal "screen-256color"
# Ожидание после ввода escape
set-option -g escape-time 1 
# Отключать сервер без активности
set-option -g exit-empty on
# Отключать сервер без клиентов
set-option -g exit-unattached on
# Запрос фокусировки у терминала
set-option -g focus-events off
# Файл в котором хранится история команд
set-option -g history-file ~/.tmux_history
# Количество сообщений в журнале для каждого клиента
set-option -g message-limit 100
# Устанавливать содержимое терминального буфера обмена с помощью escape
set-option -g set-clipboard on
# Массив описаний терминалов
set-option -g terminal-overrides[100] "xterm:colors=256"
set-option -g terminal-overrides[101] "xterm*:colors=256"
set-option -g terminal-overrides[102] "screen:colors=256"
set-option -g terminal-overrides[103] "screen*:colors=256"
# Пользовательские сочетания клавиш
# set-option -g user-keys[100] "\e[5;30012~"

# Мониторинг активности в окне
set-option -g activity-action other
# Период определяющий вставлен или набран аргумент
set-option -g assume-paste-time 1
# Мониторинг "звонка" в окне
set-option -g bell-action other
# Команда для новых окон (перекрывает default-shell)
# set-option -g default-command "vim"
# Shell по умолчанию
set-option -g default-shell "/bin/bash"
# Уничтожать сеанс без клиентов
set-option -g destroy-unattached on
# Отключаться от сервера при уничтожении сеанса
set-option -g detach-on-destroy on
# Цвет индикатора активной панели
set-option -g display-panes-active-colour "red"
# Цвет индикатора панели
set-option -g display-panes-colour "green"
# Время отображения индикаторов панели
set-option -g display-panes-time 1000
# Время отображения сообщений в строке состояния и др. задержки
set-option -g display-time 750
# Количество строк в истории окон
set-option -g history-limit 2000
# Таблица сочетаний клавиш по умолчанию
set-option -g key-table "root"
# Задержка блокировки сеанса по бездействию
set-option -g lock-after-time 1800
# Команда для блокировки сеанса
set-option -g lock-command "vlock"
# Заменяет параметры: message-command-attr message-command-bg message-command-fg
set-option -g message-command-style "bg=black,fg=yellow"
# Заменяет параметры: message-attr message-bg message-fg
set-option -g message-style "bg=yellow,fg=black"
# С версии 2.1 заменяет параметры: mode-mouse mouse-resize-pane mouse-select-pane mouse-select-window
set-option -g mouse off
# Автоматическая перенумерация окон
# set-option -g renumber-windows on
# Время ожидание повторного нажатия клавиш без префикса
set-option -g repeat-time 500
# Изменять заголовок терминала
set-option -g set-titles on
# Формат заголовка терминала
set-option -g set-titles-string "#{session_name}"
# Мониторинг "тишины" в окне
set-option -g silence-action other
# Отображать строку состояния
set-option -g status on
# Время обновления строки состояния
set-option -g status-interval 1
# Выравнивание вкладок окон в строке состояния
set-option -g status-justify left
# Стиль сочетаний клавиш в строке состояния
set-option -g status-keys vi

# THEME

# Позиция строки состояния
set-option -g status-position bottom

# Заменяет параметры: status-attr status-bg status-fg
set-option -g status-style "bg=black,fg=white"

# Заменяет параметры: status-left-attr status-left-bg status-left-fg
set-option -g status-left-style "fg=colour22"
# Размер левой части строки состояния
set-option -g status-left-length 30
# Формат левой части строки состояния
set-option -g status-left '#[fg=colour22](#S) #(whoami) '

# Формат правой части строки состояния
set-option -g status-right '#[fg=colour22,bold]#(cut -d " " -f 1-3 /proc/loadavg) %a %d %b %Y %H:%M:%S [%V/%j] '
# Размер правой части строки состояния
set-option -g status-right-length 50
# Заменяет параметры: status-right-attr status-right-bg status-right-fg
set-option -g status-right-style "default"
# Массив переменных окружения которые необходимо обновлять
set-option -g update-environment[100] "TERMINFO"

# Массив пользовательских клавиш
# set-option -g user-keys[100] "\e[1~"
# Отображать сообщение о активности в окне
set-option -g visual-activity off
# Отображать сообщение о "звонке" в окне
set-option -g visual-bell off
# Отображать сообщение о "тишине" в окне
set-option -g visual-silence off
# Символы разделителяющие слова в режиме копирования
set-option -g word-separators " -_@"

# Доступные параметры окна:

# Агрессивное изменение размера выбранного окна
set-option -gw aggressive-resize on
# Разрешить программам изменять имя окна
set-option -gw allow-rename on
# Разрешить программам использовать альтернативный экрана терминала
set-option -gw alternate-screen on
# Автоматическое переименование окон
set-option -gw automatic-rename on
# Формат автоматическо переименования окон
set-option -gw automatic-rename-format "#{?pane_in_mode,[tmux],#{pane_current_command}}#{?pane_dead,[dead],}"
# Цвет отображения времени
set-option -gw clock-mode-colour "green"
# Формат отображения времени
set-option -gw clock-mode-style 24
# Предотвращение изменениея размера окна до высоты
# set-option -gw force-height 0
# Предотвращение изменениея размера окна до ширины
# set-option -gw force-width 0
# Высота основной панели
set-option -gw main-pane-height 24
# Ширина основной панели
set-option -gw main-pane-width 80
# Стиль сочетаний клавиш в режиме копирования
set-option -gw mode-keys vi
# Заменяет параметры: mode-attr mode-bg mode-fg
set-option -gw mode-style "bg=yellow,fg=black"
# Мониторинг активности в окне
set-option -gw monitor-activity on
# Мониторинг "звонка" в окне
set-option -gw monitor-bell on
# Мониторинг "тишины" в окне. Время срабатывания.
set-option -gw monitor-silence 0
# Высота других панелей
set-option -gw other-pane-height 0
# Ширина других панелей
set-option -gw other-pane-width 0
# Заменяет параметры: pane-active-border-attr pane-active-border-bg pane-active-border-fg
set-option -gw pane-active-border-style "fg=green"
# Формат строк состояния панелей
set-option -gw pane-border-format "#{?pane_active,#[reverse],}#{?window_zoomed_flag,#[fg=red],} #{pane_index}:#{=6:pane_current_command} #[default]"
# Положение строк состояния панелей
set-option -gw pane-border-status top
# Заменяет параметры: pane-border-attr pane-border-bg pane-border-fg
set-option -gw pane-border-style "fg=green"
# Не уничтожать окно по завершению программы
set-option -gw remain-on-exit off
# Синхронизация панелей на ввод с клавиатуры
set-option -gw synchronize-panes off
# Стиль активной панели
set-option -gw window-active-style "default"
# Заменяет параметры: window-status-activity-attr window-status-activity-bg window-status-activity-fg
set-option -gw window-status-activity-style "fg=red"
# Заменяет параметры: window-status-bell-attr window-status-bell-bg window-status-bell-fg
set-option -gw window-status-bell-style "fg=red"
# Формат вкладки текущего окна в строке состояния
set-option -gw window-status-current-format " #{window_index}:#{window_name} "
# Заменяет параметры: window-status-current-attr window-status-current-bg window-status-current-fg
set-option -gw window-status-current-style "reverse"
# Формат вкладок окон в строке состояния
set-option -gw window-status-format " #{window_index}:#{window_name}#{?window_activity_flag,#,}#{?window_bell_flag,!,}#{?window_silence_flag,~,} "
# Заменяет параметры: window-status-last-attr window-status-last-bg window-status-last-fg
set-option -gw window-status-last-style "default"
# Строка разделяющая вкладки окон в строке состояния
set-option -gw window-status-separator ""
# Стиль вкладок окон в строке состояния
set-option -gw window-status-style "default"
# Стиль панелей
set-option -gw window-style "default"
# Поиск внутри панели
set-option -gw wrap-search on
# Генерировать сочетания клавиш
set-option -gw xterm-keys on

# Обновление конфигурации
bind-key r source-file ~/.tmux.conf \; display-message "Обновление конфигурации" 

bind b choose-tree
bind-key C command-prompt -p "Name of new window: " "new-window -n '%%'"
is_vim="[ $(tmux display -p '#{pane_current_command}') = vim ]"
bind-key -n C-h if-shell "$is_vim" "send-keys C-h"  "select-pane -L"
bind-key -n C-j if-shell "$is_vim" "send-keys C-j"  "select-pane -D"
bind-key -n C-k if-shell "$is_vim" "send-keys C-k"  "select-pane -U"
bind-key -n C-l if-shell "$is_vim" "send-keys C-l"  "select-pane -R"
bind-key -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"

bind-key | split-window -h -c "#{pane_current_path}"
bind-key - split-window -v -c "#{pane_current_path}"
unbind-key '"'
unbind-key %

bind-key C-x \
    kill-session -a\;\
    new-window\;\
    kill-window -a\;\
    move-window -t $base_index

bind-key C-c \
    new-window \; \
    select-window -t $base_index \; \
    split-window -h \; \
    resize-pane -x 50 \; \
    select-pane -t $base_index \; \
    split-window -v \; \
    resize-pane -y 15 \; \
    select-pane -t $base_index

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/ide'

run -b '~/.tmux/plugins/ide/ide.tmux'
